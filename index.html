<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roulette - History & Controls</title>
    <style>
        :root {
            --bg-green: #1a472a; 
            --grid-yellow: #ffd700; 
            --cell-red: #d32f2f;
            --cell-black: #222;
            --gap-size: 3px;       
            --table-padding: 8px;  
        }

        body {
            background-color: #0e2b18;
            color: white;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        /* --- HUD --- */
        .hud-container { display: flex; gap: 20px; margin-bottom: 20px; }
        .hud-box {
            background: linear-gradient(180deg, #222, #111);
            border: 1px solid #444; border-radius: 6px;
            padding: 10px 30px; text-align: center; min-width: 140px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .hud-label { font-size: 11px; color: #888; font-weight: 700; margin-bottom: 4px; text-transform: uppercase; }
        .hud-value { font-size: 18px; font-weight: 500; color: #fff; }

        /* --- MAIN LAYOUT (Table + Sidebar) --- */
        .game-area {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        /* --- TABLE CONTAINER --- */
        .table-wrapper {
            position: relative;
            background-color: var(--bg-green);
            background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.02) 0px, rgba(255,255,255,0.02) 1px, transparent 1px, transparent 10px);
            padding: 50px 60px 50px 100px; 
            border-radius: 20px;
            box-shadow: 
                inset 0 0 40px rgba(0,0,0,0.8),
                0 0 0 12px #2e5b28,
                0 20px 50px rgba(0,0,0,0.8);
        }

        /* --- HISTORY SIDEBAR --- */
        .history-sidebar {
            width: 60px;
            background: #111;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            height: 480px; /* Match approx table height */
        }

        .history-label {
            font-size: 10px; font-weight: bold; color: #aaa; margin-bottom: 5px; text-transform: uppercase;
        }

        .history-item {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 14px; color: white;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .hist-red { background: #d32f2f; }
        .hist-black { background: #222; }
        .hist-green { background: #2e7d32; }


        /* --- CHIPS CONTAINER --- */
        .chip-column {
            position: absolute; left: 20px; top: 50%;
            transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px; z-index: 100;
        }

        /* --- PREMIUM CHIP CSS --- */
        .chip {
            width: 56px; height: 56px; border-radius: 50%; position: relative; cursor: pointer;
            transition: transform 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 10px rgba(0,0,0,0.5), 0 2px 4px rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center;
        }
        .chip:hover { transform: scale(1.1); }
        .chip.active { transform: scale(1.15) translateX(5px); z-index: 101; box-shadow: 0 10px 20px rgba(0,0,0,0.6); }

        .chip::before {
            content: ''; position: absolute; inset: 0; border-radius: 50%;
            background: repeating-conic-gradient(var(--c-base) 0deg 15deg, var(--c-light) 15deg 30deg, var(--c-base) 30deg 45deg, var(--c-dark) 45deg 60deg);
            z-index: 1;
        }
        .chip::after {
            content: ''; position: absolute; inset: 6px; border-radius: 50%;
            background: var(--c-base); border: 1px solid rgba(0,0,0,0.2);
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.3), inset 0 -2px 4px rgba(0,0,0,0.3);
            z-index: 2;
        }
        .chip-label {
            position: relative; z-index: 10; width: 32px; height: 32px; background: #fdfbf7;
            border-radius: 50%; border: 1px solid #d4d4d4; display: flex; justify-content: center; align-items: center;
            font-size: 11px; font-weight: 800; color: #333; letter-spacing: -0.5px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        .chip-overlay {
            position: absolute; inset: 0; border-radius: 50%; z-index: 20; pointer-events: none;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25) 0%, transparent 40%);
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1);
        }

        /* Colors */
        .chip-50 { --c-base: #e0dfd5; --c-light: #ffffff; --c-dark: #b0b0a8; }
        .chip-100 { --c-base: #6b1818; --c-light: #a32e2e; --c-dark: #3b0505; }
        .chip-1k { --c-base: #1e4d2b; --c-light: #367a48; --c-dark: #0d2613; }
        .chip-10k { --c-base: #142850; --c-light: #2c4d87; --c-dark: #050e21; }
        .chip-100k { --c-base: #262626; --c-light: #444444; --c-dark: #000000; }

        /* Board Markers */
        .marker-wrapper { position: absolute; transform: translate(-50%, -50%); pointer-events: none; z-index: 100; }
        .marker-chip { width: 28px; height: 28px; font-size: 8px; }
        .marker-chip .chip-label { width: 16px; height: 16px; font-size: 7px; }
        .marker-chip::after { inset: 4px; }

        /* --- THE GRID --- */
        .grid-frame {
            display: grid;
            grid-template-columns: 60px repeat(12, 48px) 40px;
            grid-template-rows: repeat(3, 48px) 50px 50px;
            gap: var(--gap-size); padding: var(--table-padding);
            border: 2px solid var(--grid-yellow); background-color: transparent; border-radius: 8px; position: relative;
        }
        .cell {
            display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 18px; color: #fff;
            cursor: pointer; position: relative; border: 2px solid var(--grid-yellow); box-sizing: border-box; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .red-cell { background-color: var(--cell-red); }
        .black-cell { background-color: var(--cell-black); }
        .zone-0 { grid-column: 1; grid-row: 1 / 4; background-color: var(--bg-green); font-size: 26px; border-top-left-radius: 20px; border-bottom-left-radius: 20px; }
        .zone-2to1 { grid-column: 14; background-color: var(--bg-green); font-size: 12px; writing-mode: vertical-rl; color: #ffd700; }
        .label-cell { background-color: var(--bg-green); color: white; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        .zone-dozen { grid-row: 4; } .doz-1 { grid-column: 2 / 6; } .doz-2 { grid-column: 6 / 10; } .doz-3 { grid-column: 10 / 14; }
        .zone-bottom { grid-row: 5; } .low { grid-column: 2 / 4; } .even { grid-column: 4 / 6; } .odd { grid-column: 10 / 12; } .high { grid-column: 12 / 14; }
        .diamond-cell { grid-column: 6 / 8; grid-row: 5; background-color: var(--bg-green); display: flex; align-items: center; justify-content: center; }
        .diamond-cell.black-bg { grid-column: 8 / 10; }
        .diamond { width: 28px; height: 28px; transform: rotate(45deg); pointer-events: none; }
        .diamond.red { background-color: var(--cell-red); } .diamond.black { background-color: #111; }
        .cell.highlighted { filter: brightness(1.3); box-shadow: inset 0 0 0 2px white; background-color: rgba(255,255,255,0.15) !important; }

        .ghost-overlay { position: absolute; top: var(--table-padding); left: var(--table-padding); width: calc(100% - (var(--table-padding) * 2)); height: calc(100% - (var(--table-padding) * 2)); pointer-events: none; z-index: 50; }
        .hotspot { position: absolute; z-index: 60; cursor: pointer; pointer-events: auto; }

        /* --- BOTTOM CONTROLS --- */
        .bottom-controls { margin-top: 30px; display: flex; gap: 10px; }
        .ctrl-btn {
            background: linear-gradient(180deg, #333, #1a1a1a); color: #ccc; border: 1px solid #444;
            padding: 12px 24px; font-size: 12px; font-weight: 700; border-radius: 4px; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 4px 0 #111; letter-spacing: 0.5px; transition: transform 0.1s, box-shadow 0.1s;
        }
        .ctrl-btn:hover { color: white; background: linear-gradient(180deg, #444, #222); }
        .ctrl-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #111; }
        
        .btn-clear { background: linear-gradient(180deg, #420, #210); color: #faa; border-color: #622; }
        .btn-undo { background: linear-gradient(180deg, #022, #011); color: #aff; border-color: #266; }
        .btn-rebet { background: linear-gradient(180deg, #224, #112); color: #aaf; border-color: #226; }

    </style>
</head>
<body>

    <div class="hud-container">
        <div class="hud-box">
            <div class="hud-label">Balance</div>
            <div class="hud-value" id="moneyDisplay">1,000,000</div>
        </div>
        <div class="hud-box">
            <div class="hud-label">Current Bet</div>
            <div class="hud-value" id="betDisplay">0</div>
        </div>
    </div>

    <div class="game-area">
        
        <div class="table-wrapper">
            <div class="chip-column">
                <div class="chip chip-50 active" onclick="setChip(50, this)">
                    <div class="chip-overlay"></div><div class="chip-label">50</div>
                </div>
                <div class="chip chip-100" onclick="setChip(100, this)">
                    <div class="chip-overlay"></div><div class="chip-label">100</div>
                </div>
                <div class="chip chip-1k" onclick="setChip(1000, this)">
                    <div class="chip-overlay"></div><div class="chip-label">1K</div>
                </div>
                <div class="chip chip-10k" onclick="setChip(10000, this)">
                    <div class="chip-overlay"></div><div class="chip-label">10K</div>
                </div>
                <div class="chip chip-100k" onclick="setChip(100000, this)">
                    <div class="chip-overlay"></div><div class="chip-label">100K</div>
                </div>
            </div>

            <div class="grid-frame" id="grid">
                <div class="ghost-overlay" id="overlay"></div>

                <div class="cell zone-0" id="cell-0">0</div>
                <div class="cell zone-2to1" style="grid-row: 1" id="btn-row1">2 TO 1</div>
                <div class="cell zone-2to1" style="grid-row: 2" id="btn-row2">2 TO 1</div>
                <div class="cell zone-2to1" style="grid-row: 3" id="btn-row3">2 TO 1</div>
                <div class="cell label-cell zone-dozen doz-1" id="btn-doz1">1st 12</div>
                <div class="cell label-cell zone-dozen doz-2" id="btn-doz2">2nd 12</div>
                <div class="cell label-cell zone-dozen doz-3" id="btn-doz3">3rd 12</div>
                <div class="cell label-cell zone-bottom low" id="btn-low">1 TO 18</div>
                <div class="cell label-cell zone-bottom even" id="btn-even">EVEN</div>
                <div class="cell label-cell diamond-cell" id="btn-red"><div class="diamond red"></div></div>
                <div class="cell label-cell diamond-cell black-bg" id="btn-black"><div class="diamond black"></div></div>
                <div class="cell label-cell zone-bottom odd" id="btn-odd">ODD</div>
                <div class="cell label-cell zone-bottom high" id="btn-high">19 TO 36</div>
            </div>
        </div>

        <div class="history-sidebar" id="historyLog">
            <div class="history-label">HISTORY</div>
            <div class="history-item hist-red">3</div>
            <div class="history-item hist-black">26</div>
            <div class="history-item hist-green">0</div>
            <div class="history-item hist-red">12</div>
            <div class="history-item hist-black">35</div>
            <div class="history-item hist-red">7</div>
            <div class="history-item hist-red">19</div>
            <div class="history-item hist-black">2</div>
        </div>

    </div>

    <div class="bottom-controls">
        <button class="ctrl-btn" onclick="preset('voisins')">Voisins</button>
        <button class="ctrl-btn" onclick="preset('tier')">Tier</button>
        <button class="ctrl-btn" onclick="preset('orphelins')">Orphelins</button>
        <button class="ctrl-btn" onclick="preset('neighbors')">Neighbors</button>
        
        <div style="width: 20px;"></div> <button class="ctrl-btn btn-undo" onclick="undoBet()">Undo</button>
        <button class="ctrl-btn btn-rebet" onclick="rebet()">Rebet</button>
        <button class="ctrl-btn btn-clear" onclick="clearBets()">Clear Bets</button>
    </div>

<script>
    /* --- CONFIG & STATE --- */
    let money = 1000000;
    let currentBet = 0;
    let chipValue = 50; 
    const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
    
    const GAP = 3; const ZERO_W = 60; const CELL_W = 48; const CELL_H = 48; const OFFSET_LEFT = ZERO_W + GAP; 

    // Active Chips Map: "x_y" -> { amount, element, label }
    let activeChips = {}; 
    
    // Stack for Undo: [ { key: "x_y", val: 50, nums: [...] }, ... ]
    let actionStack = [];

    // Store Last Round bets for Rebet: [ { key, val, nums, x, y } ]
    let lastRoundBets = [];

    const gridEl = document.getElementById('grid');
    const overlay = document.getElementById('overlay');

    function init() {
        buildNumbers(); buildHotspots(); bindSideBets(); updateUI();
    }

    /* --- BUILDERS --- */
    function buildNumbers() {
        bindAction(document.getElementById('cell-0'), [0]);
        for (let i = 1; i <= 36; i++) {
            let el = document.createElement('div');
            el.className = `cell ${redNumbers.includes(i) ? 'red-cell' : 'black-cell'}`;
            el.innerText = i; el.id = `cell-${i}`;
            let row = (i % 3 === 0) ? 1 : (i % 3 === 2 ? 2 : 3);
            let col = Math.floor((i-1)/3) + 2; 
            el.style.gridRow = row; el.style.gridColumn = col;
            bindAction(el, [i]); gridEl.appendChild(el);
        }
    }

    function buildHotspots() {
        for (let c = 0; c < 12; c++) {
            let x = OFFSET_LEFT + (c * (CELL_W + GAP));
            let nTop = (c * 3) + 3; let nMid = (c * 3) + 2; let nBot = (c * 3) + 1;

            createZone(x, CELL_H - 4, CELL_W, 8 + GAP, [nTop, nMid]);
            createZone(x, (CELL_H * 2) + GAP - 4, CELL_W, 8 + GAP, [nMid, nBot]);

            if (c < 11) {
                let borderX = x + CELL_W - 4;
                let nextTop = nTop + 3; let nextMid = nMid + 3; let nextBot = nBot + 3;
                createZone(borderX, 0, 8 + GAP, CELL_H, [nTop, nextTop]);
                createZone(borderX, CELL_H + GAP, 8 + GAP, CELL_H, [nMid, nextMid]);
                createZone(borderX, (CELL_H * 2) + (GAP * 2), 8 + GAP, CELL_H, [nBot, nextBot]);
                createZone(borderX, CELL_H - 4, 8 + GAP, 8 + GAP, [nTop, nMid, nextTop, nextMid]);
                createZone(borderX, (CELL_H * 2) + GAP - 4, 8 + GAP, 8 + GAP, [nMid, nBot, nextMid, nextBot]);
                createZone(x, 0, CELL_W, 8, [nBot, nMid, nTop]); 
                createZone(borderX, 0, 8+GAP, 8, [nBot, nMid, nTop, nextBot, nextMid, nextTop]);
            }
        }
    }

    function createZone(left, top, w, h, numbers) {
        let el = document.createElement('div'); el.className = 'hotspot';
        el.style.left = left + 'px'; el.style.top = top + 'px';
        el.style.width = w + 'px'; el.style.height = h + 'px';
        bindAction(el, numbers); overlay.appendChild(el);
    }

    function bindSideBets() {
        const range = (s, e) => Array.from({length: e-s+1}, (_, i) => s + i);
        bindAction(document.getElementById('btn-doz1'), range(1, 12));
        bindAction(document.getElementById('btn-doz2'), range(13, 24));
        bindAction(document.getElementById('btn-doz3'), range(25, 36));
        bindAction(document.getElementById('btn-low'), range(1, 18));
        bindAction(document.getElementById('btn-high'), range(19, 36));
        bindAction(document.getElementById('btn-even'), range(1, 36).filter(n => n % 2 === 0));
        bindAction(document.getElementById('btn-odd'), range(1, 36).filter(n => n % 2 !== 0));
        bindAction(document.getElementById('btn-red'), redNumbers);
        bindAction(document.getElementById('btn-black'), range(1, 36).filter(n => !redNumbers.includes(n)));
        bindAction(document.getElementById('btn-row1'), range(1, 36).filter(n => n % 3 === 0));
        bindAction(document.getElementById('btn-row2'), range(1, 36).filter(n => n % 3 === 2));
        bindAction(document.getElementById('btn-row3'), range(1, 36).filter(n => n % 3 === 1));
    }

    function bindAction(el, numbers) {
        if (!el) return;
        el.onmouseenter = () => { el.classList.add('highlighted'); toggleHighlight(numbers, true); };
        el.onmouseleave = () => { el.classList.remove('highlighted'); toggleHighlight(numbers, false); };
        el.onclick = (e) => {
            let rect = el.getBoundingClientRect(); let oRect = overlay.getBoundingClientRect();
            let x = (rect.left + rect.width / 2) - oRect.left;
            let y = (rect.top + rect.height / 2) - oRect.top;
            placeBetLogic(x, y, chipValue, numbers);
        };
    }

    function toggleHighlight(numbers, active) {
        numbers.forEach(n => {
            let cell = document.getElementById(`cell-${n}`);
            if (cell) {
                if (active) cell.classList.add('highlighted');
                else cell.classList.remove('highlighted');
            }
        });
    }

    function setChip(val, el) {
        chipValue = val;
        document.querySelectorAll('.chip-column .chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
    }

    /* --- BETTING LOGIC --- */
    function placeBetLogic(x, y, val, numbers, isRebet = false) {
        if (money < val) { alert("Insufficient funds"); return; }
        
        money -= val;
        currentBet += val;
        
        // Key for aggregation
        let key = Math.round(x) + "_" + Math.round(y);
        
        // Push to stack for Undo
        if(!isRebet) {
             actionStack.push({ key: key, val: val, x: x, y: y });
        }

        if (!activeChips[key]) activeChips[key] = { amount: 0, element: null, label: null };
        activeChips[key].amount += val;
        
        renderChip(key, x, y);
        updateUI();
    }

    function renderChip(key, x, y) {
        let total = activeChips[key].amount;
        let styleClass = 'chip-50';
        if (total >= 100000) styleClass = 'chip-100k';
        else if (total >= 10000) styleClass = 'chip-10k';
        else if (total >= 1000) styleClass = 'chip-1k';
        else if (total >= 100) styleClass = 'chip-100';

        if (!activeChips[key].element) {
            let wrapper = document.createElement('div'); wrapper.className = 'marker-wrapper';
            wrapper.style.left = x + 'px'; wrapper.style.top = y + 'px';

            let chip = document.createElement('div'); chip.className = `chip marker-chip ${styleClass}`;
            let ov = document.createElement('div'); ov.className = 'chip-overlay';
            let lb = document.createElement('div'); lb.className = 'chip-label';
            lb.innerText = formatText(total);

            chip.appendChild(ov); chip.appendChild(lb); wrapper.appendChild(chip);
            overlay.appendChild(wrapper);
            activeChips[key].element = chip; activeChips[key].label = lb; activeChips[key].wrapper = wrapper;
        } else {
            activeChips[key].element.className = `chip marker-chip ${styleClass}`;
            activeChips[key].label.innerText = formatText(total);
            // Pop animation
            activeChips[key].element.style.transform = 'scale(1.3)';
            setTimeout(() => activeChips[key].element.style.transform = 'scale(1)', 100);
        }
    }

    function undoBet() {
        if (actionStack.length === 0) return;
        let lastAction = actionStack.pop();
        
        // Refund
        money += lastAction.val;
        currentBet -= lastAction.val;
        
        // Reduce Aggregated Amount
        let key = lastAction.key;
        activeChips[key].amount -= lastAction.val;
        
        if (activeChips[key].amount <= 0) {
            // Remove completely
            activeChips[key].wrapper.remove();
            delete activeChips[key];
        } else {
            // Re-render
            renderChip(key, lastAction.x, lastAction.y);
        }
        updateUI();
    }

    function clearBets(isSave = true) {
        if (isSave && currentBet > 0) {
            // Save state for Rebet
            // We need to save the aggregate state to make rebet cleaner?
            // Or just save the action stack. Action stack is better for simple restoration.
            // Actually, simpler: Save the ACTIVE CHIPS list.
            lastRoundBets = [];
            for (let key in activeChips) {
                // We need x,y. We can parse key or store it.
                // We stored wrapper left/top in style.
                let wrap = activeChips[key].wrapper;
                let x = parseFloat(wrap.style.left);
                let y = parseFloat(wrap.style.top);
                lastRoundBets.push({
                    x: x, y: y,
                    amount: activeChips[key].amount
                });
            }
        }

        money += currentBet; // Demo Refund
        currentBet = 0;
        updateUI();
        
        // Wipe Board
        overlay.innerHTML = ''; 
        activeChips = {};
        actionStack = [];
        buildHotspots(); // Hotspots wiped by innerHTML clear? Yes, they are in overlay. Rebuild.
    }

    function rebet() {
        if (lastRoundBets.length === 0) return;
        if (currentBet > 0) clearBets(false); // Clear current before rebetting? Usually yes.

        // Re-apply bets
        // Since money was refunded on clear, we just deduc again.
        lastRoundBets.forEach(bet => {
            // We treat the whole stack as one "bet" action for simplicity in rebet
            if(money >= bet.amount) {
                placeBetLogic(bet.x, bet.y, bet.amount, [], true); // true = don't push to undo stack individually? 
                // Actually, let's push to undo stack so they can undo rebet components? 
                // Or maybe push one giant undo? For now, standard behavior.
            }
        });
    }

    function formatText(val) {
        if (val >= 1000) return (val / 1000) + 'K';
        return val;
    }

    function preset(type) {
        let nums = [];
        if (type === 'voisins') nums = [0, 2, 3, 4, 7, 12, 15, 18, 19, 21, 22, 25, 26, 28, 29, 32, 35];
        if (type === 'tier') nums = [5, 8, 10, 11, 13, 16, 23, 24, 27, 30, 33, 36];
        if (type === 'orphelins') nums = [1, 6, 9, 14, 17, 20, 31, 34];
        
        nums.forEach(n => {
            let cell = document.getElementById(`cell-${n}`);
            if(cell) {
                let rect = cell.getBoundingClientRect();
                let oRect = overlay.getBoundingClientRect();
                placeBetLogic(
                    (rect.left + rect.width/2) - oRect.left,
                    (rect.top + rect.height/2) - oRect.top,
                    chipValue, [n]
                );
            }
        });
    }

    function updateUI() {
        document.getElementById('moneyDisplay').innerText = money.toLocaleString();
        document.getElementById('betDisplay').innerText = currentBet.toLocaleString();
    }

    init();

</script>
</body>
</html>
